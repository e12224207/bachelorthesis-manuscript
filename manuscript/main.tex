% Document class and page setup
\documentclass[11pt]{report}
\usepackage[paper=a4paper,margin=2.5cm]{geometry}

%=== Syntax highlighting ===
\usepackage[outputdir=out, newfloat]{minted}
\setminted{
  fontsize=\small
}

%=== Fonts ===
\usepackage{fontspec}
% Point fontspec at your local fonts folder:
\setmainfont{EBGaramon}[
  Path      = font/,       % relative to main.tex
  Extension = .ttf,
  UprightFont    = *d12-Regular,
  BoldFont       = *d08-Regular,
  ItalicFont     = *d12-Italic,
  BoldItalicFont = *d08-Italic
]

%=== Mathematics ===
\usepackage{amsfonts}

%=== Layout and typography ===
\usepackage{caption}
\usepackage{multicol}
\usepackage{microtype}
\usepackage{titlesec}
\titleformat{\chapter}[hang]{\normalfont\huge\bfseries}{}{0pt}{}
\titlespacing*{\chapter}{0pt}{1.5em}{1em}
% Prevent chapters from starting on a new page
\usepackage{etoolbox}
\makeatletter
  % In the standard report class \chapter does:
  %    \if@openright \cleardoublepage \else \clearpage \fi
  % so we remove that entire conditional.
  \patchcmd{\chapter}
    {\if@openright\cleardoublepage\else\clearpage\fi}
    {}
    {}{}

  % Starred chapters (\chapter*) invoke \@schapter and do a \clearpage
  \patchcmd{\@schapter}
    {\clearpage}
    {}
    {}{}
\makeatother
%=== Graphics and diagrams ===
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{xcolor}
\definecolor{lightgray}{gray}{0.97}

\usepackage{tikz}
\usetikzlibrary{
  arrows.meta,      % nicer arrow tips
  shapes.geometric, % rectangle, diamond, etc.
  positioning,      % easy relative placement
  chains,           % flow‐style “chain” syntax
  calc              % coordinate arithmetic
}
\tikzset{
  process/.style = {
    rectangle,
    draw,
    minimum width=3cm,
    minimum height=1cm,
    text centered,
    on chain
  },
  arrow/.style   = {
    -Stealth,
    thick
  },
  start chain    = going below,  % default chain direction
  node distance  = 8mm            % space between chain nodes
}

\usepackage{forest}

%=== Hyperlinks ===
\usepackage[colorlinks,linkcolor=blue,urlcolor=cyan]{hyperref}

%=== Metadata ===
\newcommand{\thesistitle}{VS Code Language Extension - MiniProb}
\newcommand{\authorname}{Rafael Tanzer}
\newcommand{\supervisor}{Michele Chiaria, Simone , Francesco Pontigia and Ezio Bartocci}
\newcommand{\institution}{TU Vienna}
\newcommand{\department}{Cyber-Physical Systems$_{E191-01}$}
\newcommand{\logoimage}{graphics/logo.png} % Path to your logo image
\newcommand{\submissionmonth}{May}
\newcommand{\submissionyear}{2025}
\newcommand{\submissionday}{24}

%=== File Metadata ======
\begin{filecontents*}[overwrite]{\jobname.xmpdata}
\Author{\authorname}
\Title{\thesistitle}
\Language{de-AT}
\Keywords{a\sep list\sep of\sep keywords}
\Publisher{TU Wien}
\Subject{Thesis}
\end{filecontents*}

%=== Bibliography ===
\usepackage[backend=biber, style=numeric]{biblatex}
\addbibresource{bibliography/theory.bib}
\addbibresource{bibliography/implementation.bib}

%=== Custom BNF and code styling ===
\usepackage{./simplebnf}
\def\code#1{\texttt{\detokenize{#1}}}

\begin{document}

%—— German Title Page ——
\begin{titlepage}
  % Top‑left TU Wien logo
  \noindent
  \includegraphics[width=0.3\textwidth]{graphics/tuWienLogo.png}

  % push down to center the main block
  \vspace*{\fill}

  % Centered metadata block
  \begin{center}
    {\Huge \thesistitle}\\[1cm]
    \includegraphics[width=0.15\textwidth]{\logoimage}\\[1cm]
    {\LARGE BACHELORARBEIT}\\[0.5cm]
    zur Erlangung des akademischen Grades\\[0.5cm]
    {\Large Bachelor of Science}\\[0.5cm]
    im Rahmen des Studiums\\[0.5cm]
    \textit{Bachelor programme Software \& Information Engineering}\\[1cm]
    eingereicht von\\[0.5cm]
    {\Large \authorname}\\[0.5cm]
    Matrikelnummer 12224207
  \end{center}

  % Left‑aligned faculty / advisors block
  \vspace*{1cm}
  \noindent
  an der Fakultät für Informatik: \department\\
  der Technischen Universität Wien\\
  
  \vspace*{0.5cm}
  \noindent
  \begin{tabular}{@{}r @{\quad} l@{}}
    Betreuung: & Ezio Bartocci\\
    Mitwirkung: & Michele Chiari\\
              & Francesco Pontiggia
  \end{tabular}

  % push rest down to bottom
  \vspace*{\fill}

  \noindent
  \makebox[\textwidth]{%
    {\small Wien, \submissionday~\submissionmonth~\submissionyear}%
    \hfill
    \begin{tabular}[t]{@{\hspace{2cm}}c@{\hspace{0.2cm}}c@{}}
      \rule{5cm}{0.4pt} & \rule{5cm}{0.4pt} \\[-0.3ex]
      {\small \authorname} & {\small Ezio Bartocci}
    \end{tabular}%
  }
\end{titlepage}


%—— English Title Page ——
\begin{titlepage}
  % Top‑left TU Wien logo
  \noindent
  \includegraphics[width=0.3\textwidth]{graphics/tuWienLogo.png}

  % push down to center the main block
  \vspace*{\fill}

  % Centered metadata block
  \begin{center}
    {\Huge \thesistitle}\\[1cm]
    \includegraphics[width=0.15\textwidth]{\logoimage}\\[1cm]
    {\LARGE BACHELOR'S THESIS}\\[0.5cm]
    for the degree of\\[0.5cm]
    {\Large Bachelor of Science}\\[0.5cm]
    within the study programme of\\[0.5cm]
    \textit{Bachelor programme Software \& Information Engineering}\\[1cm]
    submitted by\\[0.5cm]
    {\Large \authorname}\\[0.5cm]
    Student ID 12224207
  \end{center}

  % Left‑aligned faculty / advisors block
  \vspace*{1cm}
  \noindent
  to the Faculty of Informatics: \department\\
  at the TU Wien\\

  \vspace*{0.5cm}
  \noindent
  \begin{tabular}{@{}r @{\quad} l@{}}
    Advisor:    & Ezio Bartocci\\
    Assistance: & Michele Chiari\\
              & Francesco Pontiggia
  \end{tabular}

  % push rest down to bottom
  \vspace*{\fill}

  \noindent
  \makebox[\textwidth]{%
    {\small Vienna, \submissionday~\submissionmonth~\submissionyear}%
    \hfill
    \begin{tabular}[t]{@{\hspace{2cm}}c@{\hspace{0.2cm}}c@{}}
      \rule{5cm}{0.4pt} & \rule{5cm}{0.4pt} \\[-0.3ex]
      {\small \authorname} & {\small Ezio Bartocci}
    \end{tabular}%
  }
\end{titlepage}

%–– Eidesstattliche Erkärung ––%
\thispagestyle{empty}
\begin{flushright}
  {\LARGE\bfseries Erklärung zur Verfassung der Arbeit\par}
\end{flushright}

\vspace{4cm}
\noindent
{\large \authorname}

\vspace{2cm}

% ––– Main declaration text –––
\noindent
Hiermit erkläre ich, dass ich diese Arbeit selbständig verfasst habe, dass ich die verwendeten Quellen und Hilfsmittel vollständig angegeben habe und dass ich die Stellen der Arbeit - einschließlich Tabellen, Karten und Abbildungen -, die anderen Werken oder dem Internet im Wortlaut oder dem Sinn nach entnommen sind, auf jeden Fall unter Angabe der Quelle als Entlehnung kenntlich gemacht habe.

\medskip

\noindent
Ich erkläre weiters, dass ich mich generativer KI-Tools lediglich als Hilfsmittel bedient habe und in der vorliegenden Arbeit mein gestalterischer Einfluss überwiegt. In der "Anerkennung"(Acknowledgements) habe ich alle generativen KI-Tools gelistet, die verwendet wurden, und angegeben, wo und wie sie verwendet wurden. Für Textpassagen, die ohne substantielle Änderungen übernommen wurden, haben ich jeweils die von mir formulierten Eingaben (Prompts) und die verwendete IT-Anwendung mit ihrem Produktnamen und Versionsnummer/Datum angegeben.

\vfill

% ––– Footer: date left, signature right –––
\noindent
\begin{minipage}[t]{0.5\textwidth}
  Wien, \submissionday.~\submissionmonth~\submissionyear
\end{minipage}%
\hfill
\begin{minipage}[t]{0.4\textwidth}
  \hrulefill\\
  \centering \authorname
\end{minipage}

\pagenumbering{roman}
\cleardoublepage
% — Right-aligned, large title —
\phantomsection
\begin{flushright}
  {\Huge\bfseries Abstract\par}
\end{flushright}
\addcontentsline{toc}{chapter}{Abstract}
% Push the block down
\vspace*{3cm}

% Abstract text
\noindent
Cyber-Physical Systems demand rigorous, automated verification to ensure safety and correctness under uncertainty. This thesis presents the design and implementation of
a Visual Studio Code language extension for \textbf{MiniProb} (\ref{sec:miniprob}), a domain-specific probabilistic programming language tailored to formal model
checking of recursive, stochastic processes. Building on the Langium framework - written in TypeScript and running on Node.js - and the Language Server Protocol,
a formal EBNF grammar for MiniProb was defined and used within Langium to generate a parser that produces both Concrete Syntax Trees (CSTs) and
typed Abstract Syntax Trees (ASTs). Custom services - including semantic validation, type checking, cross-reference resolution, and some code completion features -
were developed within Langium.

\vspace{1ex}

\noindent
The extension, packaged as a .vsix and available on \hyperlink{https://github.com/e12224207/miniprob}{GitHub}, streamlines the development of MiniProb programs 
by lowering the barrier to entry for probabilistic model authors and facilitating direct translation of MiniProb programs into probabilistic operator precedence
automata for formal verification.

\vspace{1ex}

\noindent
This work demonstrates that modern editor tooling, when coupled with robust language engineering frameworks, can significantly enhance the usability and accessibility
of specialized DSLs in safety-critical CPS contexts.

\clearpage

\phantomsection
\begin{flushright}
  {\Huge\bfseries \contentsname\par}
\end{flushright}
\addcontentsline{toc}{chapter}{Contents}
\begingroup
  \renewcommand{\contentsname}{\vspace{-1cm}}%
  \tableofcontents
\endgroup

\cleardoublepage
\pagenumbering{arabic}

%=== Part I - Foundations ===%
\begin{refsection}
  \part{Foundations}
  \include{part1}
\end{refsection}

%=== Part II - Design & Implementation ===%
\begin{refsection}
  \part{Design \& Implementation}
  \include{part2}
\end{refsection}

%=== References ===%
\cleardoublepage
\printbibliography[heading=subbibliography,title={Foundations},section=1]
\printbibliography[heading=subbibliography,title={Technological Implementation},section=2]

%\printbibliography

\appendix

\clearpage
\chapter{Acknowledgements}

\noindent I would like to thank my supervisory team - Michele Chiari, Francesco Pontiggia and Ezio Bartocci - for generously sharing their expertise throughout this project.
Their patient guidance on implementation details, contextual foundations, and domain-specific nuances of the application was invaluable. Whenever I encountered a technical
hurdle or needed deeper insight into the domain, they were always ready with thoughtful advice and resources.
\vspace{1ex}
\noindent I would also like to acknowledge the use of ChatGPT 4o-mini-high during the preparation of this thesis. I used it to enhance my writing by correcting grammar
and spelling errors, as well as improve the overall tone and wording.
Furthermore, the AI-tools was used as a consultation on common topics and for creating the Biblatex citations.
All final texts and substantive content, however, reflect my own efforts and have been critically reviewed by me.
\clearpage

\chapter{Abbreviations}
\begin{description}
  \item[API] Application Programming Interface
  \item[AST] Abstract Syntax Tree
  \item[BNF] Backus-Naur Form
  \item[BOOL] Boolean
  \item[CAV] Computer-Aided Verification
  \item[CFG] Context-Free Grammar
  \item[CLI] Command-Line Interface
  \item[CPS] Cyber-Physical System
  \item[CS] Computer Science
  \item[CST] Concrete Syntax Tree
  \item[DFA] Deterministic Finite Automaton
  \item[DI] Dependency Injection
  \item[DSL] Domain-Specific Language
  \item[EBNF] Extended Backus-Naur Form
  \item[ESM] ECMAScript Module
  \item[JSON-RPC] JavaScript Object Notation -- Remote Procedure Call
  \item[LL] Left-to-right, Leftmost derivation
  \item[LR] Left-to-right, Rightmost derivation
  \item[LSP] Language Server Protocol
  \item[LTL] Linear Temporal Logic
  \item[MCMC] Markov Chain Monte Carlo
  \item[OPA] Operator Precedence Automaton
  \item[OPM] Operator Precedence Matrix
  \item[PDA] Pushdown Automaton
  \item[PEG] Parsing Expression Grammar
  \item[POTL] Procedence Operator Temporal Logic
  \item[PPL] Probabilistic Programming Language
  \item[SMC] Statistical Model Checking
  \item[SMT] Satisfiability Modulo Theories
  \item[URI] Uniform Resource Identifier
  \item[VI] Variational Inference
  \item[VS] Visual Studio
  \item[VSCE] Visual Studio Code Extension
  \item[WS] Web Services
  \item[XML] eXtensible Markup Language
\end{description}

\chapter{BNF of MiniProb}
\begin{bnf}
  $prog$ : \textsf{Program} ::=
  | $decl\_list\; func\; func\_list$
  ;;
  $decl$ : \textsf{Declaration} ::=
  | $type\; identifier\; id\_list$
  | $\epsilon$
  ;;
  $decl\_list$ ::=
  | $decl\; \code{;}\; decl\_list$
  | $\epsilon$
  ;;
  $id\_list$ ::=
  | \code{,}\; $identifier\; id\_list$
  | $\epsilon$
  ;;
  $func$ : \textsf{Function} ::=
  | $identifier\; \left(\; param\_list\; \right)\; \left\{\; decl\_list\; block\; \right\}$
  ;;
  $func\_call$ : \textsf{Func\-Call} ::=
  | $identifier\; \left(\; arg\_list\; \right)$
  ;;
  $arg$ : \textsf{Argument} ::=
  | $expr$
  ;;
  $arg\_list$ ::=
  | $arg\; arg\_list\_tail$
  | $\epsilon$
  ;;
  $arg\_list\_tail$ ::=
  | \code{,} $arg\; arg\_list\_tail$
  | $\epsilon$
  ;;
  $param$ : \textsf{Parameter} ::=
  | $type\;amp\_opt\;identifier$
  ;;
  $amp\_opt$ : \textsf{Value-result} ::=
  | \code{&}
  | $\epsilon$
  ;;
  $param\_list$ ::=
  | $param\;param\_list\_tail$
  | $\epsilon$
  ;;
  $param\_list\_tail$ ::=
  | \code{,} $param\;param\_list\_tail$
  | $\epsilon$
  ;;
  $block$ : \textsf{Codeblock} ::=
  | $stmt\; stmt\_list$
  ;;
  $block\_opt$ ::=
  | $block$
  | $\epsilon$
  ;;
  $stmt$ : \textsf{Statement} ::=
  | $assignment\;$ \code{;}
  | $query\;$ \code{;}
  | $observation\;$ \code{;}
  | $func\_call\;$ \code{;}
  | \code{throw} \code{;}
  | $if\_then\_else$
  | $while$
  | $try\_catch$
  ;;
  $stmt\_list$ ::=
  | $stmt\; stmt\_list$
  | $\epsilon$
  ;;
  $assignment$ ::=
  | $lval\; \code{=}\; assign\_rhs$
  ;;
  $assign\_rhs$  : \textsf{Right-hand side} ::=
  | $expr$
  | $distribution$
  ;;
  $query$ : \textsf{Query} ::=
  | \code{query} $func\_call$
  ;;
  $observation$ : \textsf{Conditioning} ::=
  | \code{observe} $expr$
  ;;
  $if\_then\_else$ : \textsf{IfThenElse} ::=
  | \code{if} $\left(\; expr\; \right) \left\{\; block\_opt\; \right\}$ \code{else} $\left\{\; block\_opt\; \right\}$
  ;;
  $while$ : \textsf{While-loop} ::=
  | \code{while} $\left(\; expr\; \right) \left\{\; block\_opt\; \right\}$
  ;;
  $try\_catch$ : \textsf{Try-catch}::=
  | \code{try} $\left\{\; block\_opt\; \right\} \code{catch} \left\{\; block\_opt\; \right\}$
\end{bnf}

\pagebreak

\begin{bnf}
  $lval$ : \textsf{Left-hand value} ::=
  | $identifier\;\left[\;expr\;\right]$
  | $identifier$
  ;;
  $distribution$ : \textsf{Sampling} ::=
  | \code{Bernoulli} $\left(\;expr\;\code{,}\;expr\;\right)$
  | \code{Uniform}   $\left(\;expr\;\code{,}\;expr\;\right)$
  ;;
  $expr$ : \textsf{Expression}::=
  | $logical\_or\;prob\_assign\_opt$
  ;;
  $prob\_assign\_opt$ ::=
  | $prob\_assign$
  | $\epsilon$
  ;;
  $prob\_assign$ : \textsf{Probabilistic Assignment} ::=
  | $prob\_choice\;expr$
  ;;
  $prob\_choice$ ::=
  | $\left\{\;expr\;\code{\:}\;expr\;\right\}$
  ;;
  $logical\_or$ ::=
  | $logical\_and\;logical\_or\_tail$
  ;;
  $logical\_or\_tail$ ::=
  | $\vert\vert\; logical\_and\;logical\_or\_tail$
  | $\epsilon$
  ;;
  $logical\_and$ ::=
  | $comparison\;logical\_and\_tail$
  ;;
  $logical\_and\_tail$ ::=
  | \code{&&} $comparison\;logical\_and\_tail$
  | $\epsilon$
  ;;
  $comparison$ ::=
  | $term\;comparison\_tail$
  ;;
  $comparison\_tail$ ::=
  | $comparison\_op\;term\;comparison\_tail$
  | $\epsilon$
  ;;
  $comparison\_op$ ::=
  | \code{>}
  | \code{>=}
  | \code{<}
  | \code{<=}
  | \code{==}
  | \code{!=}
  ;;
  $term$ ::=
  | $factor\;term\_tail$
  ;;
  $term\_tail$ ::=
  | \code{+} $factor\;term\_tail$
  | \code{-} $factor\;term\_tail$
  | $\epsilon$
  ;;
  $factor$ ::=
  | $division\;factor\_tail$
  ;;
  $factor\_tail$ ::=
  | \code{*} $division\;factor\_tail$
  | $\epsilon$
  ;;
  $division$ ::=
  | $unary\;division\_tail$
  ;;
  $division\_tail$ ::=
  | \code{/} $unary\;division\_tail$
  | \texttt{\%} $unary\;division\_tail$
  | $\epsilon$
  ;;
  $unary$ ::=
  | $unary\_op\;unary$
  | $primary$
  ;;
  $unary\_op$ ::=
  | \code{!}
  | \code{-}
  ;;
  $primary$ ::=
  | $bool$
  | $int\_literal$
  | $lval$
  | $\left(\;expr\;\right)$
\end{bnf}

\pagebreak

\begin{bnf}
  $identifier$ : \textsf{Name} ::=
  | $letter\;ident\_tail$
  ;;
  $ident\_tail$ ::=
  | $letter\_or\_digit\;ident\_tail$
  | \code{.} $ident\_tail$
  | $\colon\; ident\_tail$
  | \code{~} $ident\_tail$
  | $\epsilon$
  ;;
  $letter$ ::=
  | \code{a}
  | \code{b}
  | …
  | \code{Z}
  | \code{_}
  ;;
  $digit$ ::=
  | \code{0}
  | …
  | \code{9}
  ;;
  $letter\_or\_digit$ ::=
  | $letter$
  | $digit$
  ;;
  $type$ : \textsf{Types} ::=
  | \code{bool}
  | $int\_spec$
  | $int\_spec\;\left[\;int\_literal\;\right]$
  ;;
  $digit\_seq$ ::=
  | $digit\;digit\_seq$
  | $digit$
  ;;
  $int\_spec$ : \textsf{Integer} ::=
  | \code{u} $digit\_seq$
  | \code{s} $digit\_seq$
  ;;
  $int\_literal$ ::=
  | $digit\_seq\;int\_spec$
  ;;
  $bool$ : \textsf{Boolean} ::=
  | \code{true}
  | \code{false}
\end{bnf}
\captionof{listing}{Backus-Naur form of MiniProb grammar}
\label{list:miniprob-bnf}

\chapter{section}{Expanded Code Listings}
\inputminted[linenos, breaklines]{yaml}{samples/mini-prob.langium}
\captionof{listing}{Langium grammar definition of MiniProb (LL(2) parsable)}
\label{list:langium-grammar}

\end{document}
